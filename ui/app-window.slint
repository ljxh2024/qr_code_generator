import { TextEdit, Button, HorizontalBox } from "std-widgets.slint";

export component MainWindow inherits Window {
  title: "QR Code Genarator";
  width: 340px;

  in property <image> qr-code;
  in-out property <bool> is-save-success: false;
  
  callback generate-qr-code(string);
  callback save-qr-code();

  VerticalLayout {
    padding: 20px;
    spacing: 10px;

    popup := PopupWindow {
      Text {
        text: "- 保存成功 -";
        font-size: 12px;
        color: #00b300;
      }
      x: parent.width / 2.5;
      y: 10px;
    }

    timer := Timer {
      interval: 2s;
      running: false;
      triggered() => {
        self.running = false;
        popup.close();
        is-save-success = false;
      }
    }

    HorizontalBox {
      alignment: center;
      padding-top: 14px;
      
      Text {
        text: "二维码生成器";
        font-size: 20px;
        font-weight: 500;
      }
    }

    HorizontalBox {
      padding-top: 20px;
      padding-bottom: 20px;

      te := TextEdit {
        placeholder-text: "在此输入二维码内容";
        font-size: 13px;
        height: 80px;
        has-focus: false;
      }
    }

    Button {
      text: "生成二维码";
      enabled: te.text != "";
      clicked => {
        root.generate-qr-code(te.text);
        te.text = "";
      }
    }

    Button {
      text: "保存至本地";
      enabled: qr-code.width > 0;
      clicked => {
        root.save-qr-code();
        if (is-save-success) {
          popup.show();
          timer.running = true;
        }
      }
    }

    HorizontalBox {
      alignment: center;
      height: 232px;
      padding-top: 20px;

      Image {
        source: qr-code;
      }
    }
  }
}